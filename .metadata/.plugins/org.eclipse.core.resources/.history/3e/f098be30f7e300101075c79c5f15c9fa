#include "drivers.h"
#include "oled.h"
#include "uart.h"
#include "FreeRTOS.h"
#include "task.h"
#include <stdio.h>

TaskHandle_t sensorTaskHandle;
float avg = 0;

void sensor_task(void *arg)
{
    char buf[32];

    while(1)
    {
        // Read ADC value
        float t = convert_temp(adc_dma_buf[0]);
        avg = avg + (t-avg)/10.0f;      // Moving average smoothing

        sprintf(buf,"TEMP: %.2f C    ",avg);
        oled_print(0,4,buf);

        vTaskDelay(pdMS_TO_TICKS(500));
    }
}
