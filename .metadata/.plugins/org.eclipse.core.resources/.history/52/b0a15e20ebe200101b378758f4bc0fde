/*
 * freertos_init.c
 *
 *  Created on: Dec 26, 2025
 *      Author: sande
 */
/* application/rtos/freertos_init.c */

#include "FreeRTOS.h"
#include "task.h"
#include "freertos_init.h"
#include "uart_driver.h"
#include "gpio_driver.h"
#include "tasks_common.h"
#include "task_health.h"
#include "task_oled.h"
#include "task_sensors.h"
#include "task_cli.h"
#include "task_adc.h"

extern void task_health(void *p);
extern void task_cli(void *p);

void rtos_start(void)
{
     // Queues
        q_sensor_events = xQueueCreate(16, sizeof(event_msg_t));
        q_oled          = xQueueCreate(8,  sizeof(event_msg_t));

	uart_send_str("\r\n[RTOS] Creating tasks...\r\n");

	// Tasks
//	    xTaskCreate(HealthMonitor_Task, "Health", 256, NULL, 5, NULL);
//	    xTaskCreate(CLI_Task,           "CLI",    512, NULL, 4, NULL);
//	    xTaskCreate(Sensors_Task,       "Sensor", 512, NULL, 3, NULL);
//	    xTaskCreate(ADC_Task,           "ADC",    512, NULL, 3, NULL);
//	    xTaskCreate(OLED_Task,          "OLED",   512, NULL, 1, NULL);

    uart_send_str("[RTOS] Scheduler starting...\r\n");
    vTaskStartScheduler();

    while(1); // should never reach
}


