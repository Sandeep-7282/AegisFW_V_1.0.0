/*
 * gpio_exti.c
 *
 *  Created on: Dec 28, 2025
 *      Author: sande
 */
#include "stm32f446xx.h"
#include "interrupts.h"

void gpio_exti_init(void)
{
    /* Enable GPIO A B C clock */
    RCC->AHB1ENR |= RCC_AHB1ENR_GPIOAEN |
                    RCC_AHB1ENR_GPIOBEN |
                    RCC_AHB1ENR_GPIOCEN;

    /* Inputs */
    GPIOA->MODER &= ~(3 << (0*2));      // PA0 Button
    GPIOB->MODER &= ~(3 << (1*2));      // PB1 Impact
    GPIOC->MODER &= ~(3 << (13*2));     // PC13 PIR

    /* Internal pull-down */
    GPIOA->PUPDR |= (2 << (0*2));
    GPIOB->PUPDR |= (2 << (1*2));
    GPIOC->PUPDR |= (2 << (13*2));

    /* Enable SYSCFG Clock */
    RCC->APB2ENR |= RCC_APB2ENR_SYSCFGEN;

    /* Route pins to EXTI */
    SYSCFG->EXTICR[0] &= ~(0xF << 0);   // PA0 -> EXTI0
    SYSCFG->EXTICR[0] |=  (0x1 << 4);   // PB1 -> EXTI1
    SYSCFG->EXTICR[3] |=  (0x2 << 4);   // PC13->EXTI13

    /* Rising edge trigger */
    EXTI->RTSR |= (1<<0) | (1<<1) | (1<<13);
    EXTI->IMR  |= (1<<0) | (1<<1) | (1<<13);

    /* NVIC */
    NVIC_EnableIRQ(EXTI0_IRQn);
    NVIC_EnableIRQ(EXTI1_IRQn);
    NVIC_EnableIRQ(EXTI15_10_IRQn);
}





