/*
 * task_cli.c
 *
 *  Created on: Dec 26, 2025
 *      Author: sande
 */
/* application/rtos/tasks_cli.c */

#include "FreeRTOS.h"
#include "task.h"
#include "uart_driver.h"
#include "tasks_common.h"
#include "uart_threadsafe.h"
#include "stdio.h"

static void cli_sysinfo(void)
{
    char buffer[128];

    snprintf(buffer,128, "\r\n[SYSINFO]\r\n"
        "Free Heap     : %u bytes\r\n"
        "Task Count    : %lu\r\n"
        "-------------\r\n",
        xPortGetFreeHeapSize(),
        uxTaskGetNumberOfTasks()
    );
    uart_send_str(buffer);
}

void CLI_Task(void *p)
{
	uprintf("[CLI] Ready. Type commands (stub)\r\n");

	char input = 0;

	while(1)
	{
		 hb_cli = 1;
		 uprintf("[CLI] alive\n");
	    if(uart_rx_available())      // add basic non-blocking RX function later Day-6
	    {
	        input = uart_read();
	        if(input == 'i') cli_sysinfo();
	    }

	    uprintf("CLI> press 'i' for sysinfo\r\n");
	    vTaskDelay(pdMS_TO_TICKS(2000));
	}

}

